\documentclass[a4paper, twocolumn, 11pt, twoside]{article}

% update your language here.
\usepackage[portuges]{babel}
\usepackage{linguamatica}

% added packages
\usepackage{comment}
\usepackage{amsmath}
\usepackage{makecell} % for formating column heads
\renewcommand\theadfont{\bfseries}
\usepackage{subcaption}	% for \subtable
\usepackage{listings} % see below
\usepackage[]{program}
\usepackage{color}
\usepackage{multirow}


%% Please use UTF8 in your document

%% Set the bibliography style.
%% Styles provided for Spanish (Castilian), Catalan and Portuguese.
%% Other languages will be created on a required basis.

\bibliographystyle{sp_por}   % This for Portuguese


%% You can leave this unchanged. It will be updated by the editors when your paper gets published.
\submitted{15 de \OCT{} 2017}
\accepted{3 de \DEC{} 2017}


%% Add your title in the main language used in the article
\title{Extracção de Relações de Apoio e Oposição \\em Títulos de Notícias de Política}

%% Currenty the title in English is also mandatory
\titleEN{Extraction of Support and Opposition Relationships in Portuguese Political News Headlines}


%% Add authors here. Three lines for each author.
%% First line with author name, second with the affiliation and third with e-mail
%% In cases where a second line is needed for the affiliation, use the command \nl to separate them. 
\author{
  David S. Batista \\
  %\instituto{}
  \email{dsbatista@gmail.com} 
}


\begin{document}
\maketitle

%% Add the abstract in the main language for the article. If possible, doesn't add any citations here.
\begin{resumo}
Os títulos de notícias de política relatam com frequência interacções envolvendo personalidades políticas, sendo que muitas dessas interacções correspondem uma relação de apoio ou de oposição de uma personalidade para outra, por exemplo:

\begin{itemize}
\item{\textit{"Marques Mendes critica estratégia de Rui Rio"}}
\item{\textit{"Sócrates foi às bases apelar ao voto em Soares"}}
\end{itemize}

Neste trabalho, analisámos centenas de milhares de títulos de notícias de artigos arquivados identificando aqueles que expressam uma relação de apoio ou oposição entre duas personalidade políticas, e associamos as personalidades políticas com a sua entrada na Wikidata. Este processo resulta num grafo semântico onde os nós são personalidades representadas na Wikidata ligadas através de relações de oposição ou apoio suportadas por uma notícia, cobrindo um período de cerca de 25 anos de notícias. É possível fazer diferentes tipos de interrogações ao grafo envolvendo personalidades políticas e partidos, e.g.: .

\begin{itemize}
\item{\textit{Que personalidades do BE se opuseram a Jerónimo de Sousa?}}
\item{\textit{Que personalidades afiliadas ao BE se opuseram a personalidades do PCP?}}
\item{\textit{Quem do PS se opôs/apoiou a José Sócrates?}}
\item{\textit{Que personalidades do PS apoiaram personalidades do PSD?}}
\end{itemize}

Neste artigo descrevemos em detalhe processo de extracção dos triplos que compõem o grafo semântico. Descrevemos e fazemos pública a colecção de dados anotada manualmente, que permitiu treinar classificadores de aprendizagem supervisionada para identificar as relações expressas nos títulos, e ligar as personalidades com a Wikidata. Tornamos disponível publicamente o grafo resultante do processo de extracção, contendo um total de 680 personalidades políticas e 10.361 notícias.
\end{resumo}

%% Add keywords in the article main language, in lowercase
\palavraschave{extracção de relações semânticas, dados anotados, web semântica, RDF, PLN, ciência política}

%% Add the abstract in English
\begin{abstract}
Political news headlines often report on interactions involving political personalities, with many of these interactions corresponding to a relationship of support or opposition from one personality to another, for example:

\begin{itemize}
\item{\textit{"Marques Mendes criticizes Rui Rio's strategy"}}
\item{\textit{"Sócrates went to the bases to appeal for a vote for Soares"}}
\end{itemize}

In this work, we analyzed hundreds of thousands of news titles of archived articles and identified those that express a relationship of support or opposition between two political personalities, and we also linked the political personalities to Wikidata entry. This process resulted in a semantic graph where the nodes are personalities represented in Wikidata linked through opposition or support relationships supported by a news article, covering a period of about 25 years of news articles. It is possible to issue different types of queries to the graph involving political personalities and parties, e.g.: .

\begin{itemize}
\item{\textit{Which BE personalities opposed Jerónimo de Sousa?}}
\item{\textit{Which BE-affiliated personalities opposed PCP personalities?}}
\item{\textit{Who from the PS opposed/supported José Sócrates?}}
\item{\textit{Which PS personalities have supported PSD personalities?}}
\end{itemize}

In this paper we describe in detail the process of extracting the triples that make up the semantic graph. We describe and make public a manually annotated dataset, which allowed training supervised learning classifiers to identify the relationships expressed in the titles, and link the personalities with Wikidata. We also make publicly available the graph resulting from the extraction process, containing a total of 680 political personalities and 10,361 news stories.
\end{abstract}

%% add the keywords in English
\keywords{semantic relationships extraction, annotated dataset, semantic web, RDF, NLP, political science}

\section{Introdução}
\label{sec:intro}

Os títulos de notícias relacionados com política ou políticos relatam com frequência interacções envolvendo duas ou mais personalidades políticas. Muitas dessas interacções correspondem a uma relação de apoio ou oposição de uma personalidade para uma outra personalidade, por exemplo:

\begin{itemize}
\item{\textit{"Marques Mendes critica estratégia de Rui Rio"}}
\item{\textit{"Catarina Martins pede a demissão do governador Carlos Costa"}}
\item{\textit{"Sócrates foi às bases apelar ao voto em Soares"}}
\end{itemize}

A análise de um grande número deste tipo de relações ao longo do tempo permite vários estudos, por exemplo: encontrar quais as grandes comunidades de apoio ou oposição em função dos governos no poder ou encontrar as grandes alianças e oposições e as suas dinâmicas. Pode-se também explorar individualmente uma personalidade ao longo do tempo, por exemplo, comparando as relações de apoio ou oposição antes de tomar posse num determinado cargo público com as relações depois de ter assumido o cargo, ou ver que relações de apoio subitamente emergiram. Também pode ser usado para rapidamente reunir uma colecção de notícias contendo interacções de apoio ou oposição envolvendo personalidades e partidos políticos específicos, por exemplo, para auxiliar numa tarefa de jornalismo de investigação. Tendo um método automático para extrair estas relações e podendo aplicá-lo a uma colecção de dados abrangendo longos períodos temporais permitiria concretizar os exemplos descritos acima.

Neste trabalho apresentamos um método para extrair relações de apoio ou oposição entre personalidades políticas e descrevemos os resultados da aplicação do mesmo a uma colecção de notícias abrangendo um período de cerca de 25 anos. Durante o processo de extracção das relações ligamos as personalidades políticas envolvidas ao seu identificador na Wikidata~\citep{MKGGB2018}, enriquecendo assim a relação com informação associada à personalidade (e.g.: afiliação política, cargos públicos exercidos, legislaturas, relações familiares, etc.). 

Todas as relações extraídas são representadas sob a forma de triplos semânticos seguindo a norma Resource Description Framework (RDF)~\citep{schreiber2014primer}. As personalidades políticas envolvidas, representadas pelo seu identificador na Wikidata, são ligadas através de uma relação de oposição ou apoio representada pela notícia que dá suporte à relação, dando assim origem a um gráfico semântico. Desta forma é então possível formular interrogações SPARQL~\citep{2013sparql} envolvendo a informação da Wikidata associada a cada personalidade e as relações extraídas dos títulos de notícias, por exemplo:

\begin{itemize}
\item{Listar todas as notícias onde a personalidade X se opõe à personalidade Y}
\item{Listar os membros de um determinado partido que apoiaram alguma personalidade específica}
\item{Lista de membros de um determinado partido apoiados/opostos membros de outro partido}
\item{Lista de membros de um determinado partido apoiados/opostos membros do mesmo partido}
\item{Lista de personalidades que estão ligadas através de uma relação familiar e de uma relação de oposição/apoio}
\item{Lista de personalidades que fazem parte do mesmo Governo e que estão envolvidas numa relação de oposição/apoio}
\end{itemize}

As principais contribuições deste trabalho são: 

\begin{itemize}
\item{um grafo semântico ligando personalidades políticas representadas na Wikidata através de uma relação de oposição ou apoio suportada por uma notícia}
\item{um conjunto de dados anotados utilizado para treinar os classificadores de extracção das relações de títulos de notícias, e ligar as personalidades mencionadas à Wikidata}
\item{um interface web que permite explorar o gráfico semântico}
\end{itemize}

Este artigo está organizado da seguinte forma: na Secção~\ref{sec_related_work} referimos trabalho relacionado, na Secção~\ref{sec_kb} descrevemos a Base de Conhecimento usado no suporte de ligação das personalidades políticas à Wikidata. A Secção~\ref{sec:data_sources} refere e descreve as fontes de notícias utilizadas. Na Secção~\ref{sec:rel_data_annot} detalhamos o conjunto de dados anotados e na Secção~\ref{sec:classifiers} os classificadores de aprendizagem supervisionada desenvolvidos. Na Secção~\ref{sec:pipeline} descrevemos o processo extracção de triplos RDF e a construção do gráfico semântico. Finalmente, na Secção~\ref{sec:future_work} apresentamos ideias futuras para melhorar e continuar este trabalho.

\section{Trabalho Relacionado}
\label{sec_related_work}
A análise de sentimento tem sido maioritariamente alvo de estudo em conteúdo gerado em redes redes sociais~\citep{10.1145/3185045} ou na avaliação de produtos ou serviços~\citep{pontiki-etal-2016-semeval}. Nestes domínios o autor do texto e o alvo da opinião são explícitos. No entanto, este tipo de abordagem não se aplica no contexto de análise de notícias de política, onde existe com frequência um sentimento expresso entre actores políticos sob a forma de relações de apoio ou oposição~\citep{balahur2009opinion, balahur-etal-2010-sentiment}.

% 2013 - https://aclanthology.org/P13-1108.pdf Learning to Extract International Relations from Political Context
% 2019 - https://aclanthology.org/N19-1167.pdf No Permanent Friends or Enemies: Tracking Relationships between Nations from News
Vários autores exploraram métodos extrair relações de sentimento envolvendo actores políticos. Alguns autores exploram estas relações num contexto de política internacional, em que os actores políticos são  nações. \cite{oconnor-etal-2013-learning} propõem um modelo não supervisionado baseado em \textit{topic models} extraindo eventos ocorridos num determinado período de tempo envolvendo duas nações, e não um conjunto fechado de relações. \cite{han-etal-2019-permanent} geram de forma não supervisionada descritores de relações para pares de nações mencionadas em notícias recorrendo a \textit{embeddings} usados para ordenar o texto que descreve a relação.

% Datasets
% 2015 - https://aclanthology.org/W15-5614/ - An Annotated Corpus for Sentiment Analysis in Political News
% 2021 - https://www.sciencedirect.com/science/article/pii/S1877050921018755 - A dataset for Sentiment analysis of Entities in News headlines (SEN)
Alguns autores disponibilizam dados anotados, \cite{de-arruda-etal-2015-annotated} criaram um corpus de notícias políticas em português, anotando cada parágrafo com o sentimento segundo duas dimensões: o actor político referida pela notícia, e o sentimento dessa referência: positivo, negativo ou neutro. \cite{BARANIAK20213627} disponibilizam um corpus semelhantes para inglês e polaco.

% 2017 - https://aclanthology.org/D17-1144.pdf
\cite{cocarascu-toni-2017-identifying} propõem um método para classificar relações de apoio ou oposição de uma peça de texto para outra que ocorrem naturalmente num debate debate político.

% 2019 - Who Blames Whom in a Crisis? Detecting Blame Ties from News Articles Using Neural Networks 
% https://ojs.aaai.org/index.php/AAAI/article/view/3842/3720
\cite{liang2019blames} define a tarefa de extracção de relações de culpabilidade: dado um artigo $d$ e um conjunto de entidades $e$, detectar se existe uma relação de culpabilidade $(s,t)$, onde $s \in e$ e $t \in e$, quando $s$ culpa $t$ com base no artigo $d$, sendo que há $|e| \cdot (|e| - 1)$ possíveis relações de culpabilidade.

% 2021
% Who Blames or Endorses Whom? Entity-to-Entity Directed Sentiment Extraction in News Text
% https://aclanthology.org/2021.findings-acl.358/
No contexto de análise de notícias de política em Português, e tanto quanto é do meu conhecimento, julgo este ser um dos primeiros trabalhos a propor um método para extrair de forma automática relações de apoio e oposição entre personalidades políticas de forma a poder construir um grafo semântico, seguindo a estrutura de relações proposta por~\cite{park-etal-2021-blames}: dada uma frase $s$ referindo duas entidades $p$ e $q$, detectar qual a relação de sentimentos entre $p$ e $q$ de entre cinco possíveis: neutra, $p$ tem uma opinião positiva ou negativa em relação a $q$, ou $q$ tem uma opinião positiva ou negativa em relação a $p$.

\begin{table*}[!h]
  \centering
  \begin{tabular}{lc}
      {\bf Título} & {\bf Relação} \\
      \hline
	  \textbf{Sá Fernandes} acusa \textbf{António} Costa de defender interesses corporativos &	Ent\textsubscript{1}-opõe-se-Ent\textsubscript{2} \\
	  \textbf{Passos Coelho} é acusado de imaturidade política por \textbf{Santos Silva} &	Ent\textsubscript{2}-opõe-se-Ent\textsubscript{1}	\\
	  \textbf{Manuel Alegre} apoia candidatura de \textbf{Maria de Belém} &	Ent\textsubscript{1}-apoia-Ent\textsubscript{2}	\\
	  \textbf{Manuel Alegre} recebe apoio de \textbf{Jorge Sampaio} & Ent\textsubscript{2}-apoia-Ent\textsubscript{1}	\\
	  \textbf{Rui Tavares} e \textbf{Ana Drago} eleitos nas primárias do LIVRE & outra	\\
	  \textbf{Teresa Zambujo} reconhece vitória de \textbf{Isaltino Morais} & outra	\\
	  CDS acusa \textbf{Marcelo Rebelo de Sousa} de pôr em causa relação com \textbf{Cavaco} & outra \\
	  \hline
  \end{tabular}
  \caption{Exemplos de títulos e das relações manualmente anotadas correspondentes.}
  \label{tab:samples}
\end{table*}

\section{Base de Conhecimento}
\label{sec_kb}
Dado que as personalidades envolvidas nas relações a extrair são personalidades políticas relevantes, começámos por construir uma Base de Conhecimento usando a Wikidata~\citep{MKGGB2018}. Fazendo interrogações SPARQL~\cite{2013sparql} ao seu \textit{endpoint} público~\footnote{\url{https://query.wikidata.org/sparql}} recolhemos o identificador de todas as:

\begin{itemize}  
\item pessoas que são ou foram afiliadas a algum partido político português
\item pessoas portuguesas nascidas depois de 1935 cuja profissão seja: \textit{juiz, economista, advogado, funcionário público, político, empresário ou banqueiro}
\item pessoas que têm ou tiveram pelo menos um cargo de uma lista de cargos públicos portugueses previamente seleccionados (e.g.: \textit{ministro, líder do partido, embaixador}, etc.)
\end{itemize}  

Para além dos resultados destas interrogações, seleccionámos manualmente alguns identificadores de personalidades não abrangidas pelas interrogações SPARQL definidas acima, muitas delas de um contexto político internacional, mas que interagem com personalidades portuguesas. Acrescentamos também todos os identificadores de partidos políticos a que as personalidades possam estar afiliadas. Este processo resultou num total de 1.757 personalidades e de 37 partidos políticos. De notar, que alguns dos partidos incluídos são partidos já extintos, e alguns são partidos de um contexto internacional. Para cada um dos identificadores das personalidades e partidos políticos descarregamos a página correspondente na Wikidata utilizando um outro \textit{endpoint}\footnote{\url{https://www.wikidata.org/wiki/Special:EntityData?}} público.

% SELECT (COUNT(DISTINCT ?person) as ?nr_persons) {?person wdt:P31 wd:Q5;}
% SELECT (COUNT(DISTINCT ?person) as ?nr_parties) {?person wdt:P31 wd:Q7278;}

Para cada personalidade política, seleccionámos o seu identificador na Wikidata, o seu nome mais comum e os nomes alternativos, por exemplo combinações de nomes próprios e apelidos. Com base nestes três campos, criámos um índice no ElasticSearch~\citep{10.5555/2904394} usando a sua configuração de omissão, não fazendo uso de qualquer funcionalidade extra tais como analisadores de $n$-gramas.

\section{Fontes de dados}
\label{sec:data_sources}

A principal fonte de notícias foi o arquivo da web portuguesa~\citep{SearchPastPWA2013}. Usando a \textit{API} pública de pesquisa recolhemos páginas arquivadas restringindo os resultados a ocorrências de nomes reunidos na Secção~\ref{sec_kb} e a 45 domínios \texttt{.pt} associados a diversas fontes de informação: jornais \textit{on-line}, \textit{websites} de estações de televisão e rádio, e portais agregadores de conteúdos. 

Uma segunda fonte de notícias foi a colecção CHAVE\footnote{\url{https://www.linguateca.pt/CHAVE/}}~\citep{DBLP:conf/clef/SantosR04, santos-rocha-2001-evaluating}, contendo os artigos do jornal PÚBLICO publicados entre 1994 e 1995. Finalmente, também acrescentámos alguns artigos não arquivados pelo arquivo.pt, retirados directamente das secções {\it Mundo}, {\it Política} e {\it Sociedade} do site publico.pt. 

Deste processo resultou uma colecção de cerca de 13.7 milhões de títulos de artigos publicados entre 1994 e 2022. De seguida foi aplicado um pré-processamento de modo a remover notícias com: títulos duplicados, títulos com menos de 4 palavras, e títulos ou URLs contendo palavras que fazem partem de uma lista pré-definida (e.g.: desporto, celebridades, artes, cinema, etc.) que sugerem um o outro contexto que não política. Este pré-processamento resultou em 1.3 milhões de títulos distintos, cerca de 10\% dos dados inicialmente recolhidos.

\section{Colecção de Relações Anotadas}
\label{sec:rel_data_annot}

De forma a poder treinar classificadores de aprendizagem supervisionada para identificar automáticamente as relações presentes nos títulos das notícias, e fazer a ligação das personalidades com a Wikidata, anotámos manualmente um conjunto de títulos com: as personalidades, os identificadores na Wikidata e a relação entre as personalidades.

Começamos por pré-processar todos os títulos automáticamente. Usando o pacote de software spaCy 3.0~\citep{spacy} e com o modelo~\texttt{pt\_core\_news\_lg-3.0.0} fizemos o reconhecimento de entidades mencionadas do tipo \texttt{PESSOA}, para cada entidade reconhecida tentamos encontrar o seu identificador correspondente na Wikidata fazendo uma interrogação ao índice descrito na Secção~\ref{sec_kb} e assumindo que na lista de resultados o primeiro é o identificador correcto associado à entidade. Seleccionámos depois apenas títulos referindo duas pessoas e ambas com um identificador Wikidata associado.

Fomos depois seleccionando títulos para anotação. Sempre que necessário corrigimos as entidades reconhecidos e o identificador na Wikidata, e anotamos a relação existente: \textbf{oposição} ou \textbf{apoio}, e a direcção da mesma. Quando nenhuma das duas se verifica a relação é anotada como \textbf{outra}. A Tabela~\ref{tab:samples} demonstra alguns exemplos das relações anotadas.

Este processo resultou num conjunto de dados contendo 3.324 títulos anotados e 6.648 menções a nomes de personalidades políticas. A Tabela~\ref{tab:rel_dataset} caracteriza os dados em termos de número de relações e direcção. É de notar que a maioria dos títulos contém uma relação de \textbf{oposição} ou \textbf{outra}, e a grande maioria as relações têm uma direcção da primeira para a segunda entidade, Ent\textsubscript{1}$\rightarrow$Ent\textsubscript{2}.

% jq -r '"\(.label)"' < politiquices_data_v3.0.jsonl | sort | uniq -c

\begin{table}
    \begin{center}
    \begin{tabular}{l ccr}
        {\bf Relação} & {\bf \footnotesize{Ent\textsubscript{1}$\rightarrow$Ent\textsubscript{2}}} & {\bf \footnotesize{Ent\textsubscript{2}$\rightarrow$Ent\textsubscript{1}}} & {\bf Total} \\
        \hline
        opõe-se          &  1 155  &  102  &  1 257  \\
        apoia            &    717  &   44  &    761  \\
        outra            &    -    &   -   &  1 306  \\
		\hline
		Total			 &  1 872  &  146  &  3 324  \\
    \end{tabular}
	\caption{Relações por classe e direcção.}
	\label{tab:rel_dataset}
	\end{center}
\end{table}

% jq -r '"\(.ent1_id) \(.ent2_id)"' < politiquices_data_v3.0.jsonl | tr ' ' '\n' | sort | uniq -c | sort -gr

Das 6.648 menções a nomes de personalidades políticas apenas 708 são distintas, significando que há personalidades referidas com bastante frequência. Das 708 personalidades distintas, 517 têm um identificador na Wikidata sendo 191 não estão associadas a nenhum um identificador, por não estarem presentes na Wikidata. Este conjunto de dados encontra-se online~\footnote{\url{https://github.com/politiquices/data-releases}}.

\section{Processo de Extracção de Relações}
\label{sec:classifiers}

O processo de extração de triplos em formato Resource Description Framework (RDF)~\citep{schreiber2014primer} a partir dos títulos das notícias envolve 4 processos: 

\begin{itemize}
\item reconhecimento de entidades-mencionadas do tipo \texttt{PESSOA} nos títulos
\item ligação das entidades com um identificador da Wikidata presente na Base de Conhecimento (BC)
\item classificação do tipo de relação
\item classificação da direcção da relação
\end{itemize}

Nesta secção descrevemos em detalhe cada um destes processos.

\subsection{Reconhecimento de Entidades}
\label{subsec:ner}

% https://spacy.io/usage/rule-based-matching

O reconhecimento de entidades mencionadas é baseado num método híbrido combinando regras com um modelo supervisionado. 

Usando a componente \texttt{EntityRuler}\footnote{\url{https://spacy.io/usage/rule-based-matching}} do spaCy 3.0, definimos uma série de regras combinando padrões baseados nos nomes de todas as personalidades da BC. Para detectar as entidades do tipo pessoa este classificador aplica primeiro as regras e de seguida o modelo supervisionado para Português do spaCy. Em situações de desacordo entra as duas abordagens as entidades marcadas com regras têm prioridade.

A Tabela~\ref{tab:results_ner} mostra a performance para as 3 abordagens sob o conjunto de dados anotado, contendo 6 648 menções a nomes de personalidades políticas.

% jq -r '"\(.ent1)|\(.ent2)"' < politiquices_data_v3.0.jsonl | tr '|' '\n' | wc -l

\begin{table}[!h]
    \begin{center}
    \begin{tabular}{l ccc}
		{\bf Abordagem}  & {\bf P} & {\bf A} & {\bf F\textsubscript{1}} \\
        \hline
        Regras           &  0.99     &  0.42     & 		0.59		\\
        Modelo           &  0.97     &  0.91     & 		0.94		\\
		Regras+Modelo    &  0.97     &  0.92     & 		0.94		\\
    \end{tabular}
	\caption{ (P)recisão, A(brangência) e F\textsubscript{1} para a componente de REM combinando regras e o modelos supervisionado.}	
	\label{tab:results_ner}
	\end{center}
\end{table}

\subsection{Ligação com a Wikidata}
\label{subsec:ent_linking}

O procedimento para associar as personalidades com identificadores na Wikidata tenta numa primeira fase usar apenas o título da notícia, se este processo falhar, tenta então usar possíveis referências às personalidades no texto da notícia. A similaridades entre candidatos da BC e as personalidades referidos no texto são calculadas com a similaridade Jaro~\citep{jaro1989}.

Na primeira fase o algoritmo começa por gerar uma lista de candidatos, para uma determinada personalidade usando a BC. Se a lista contem apenas um candidato e a similaridade para com a personalidade referida no título é de pelo menos 0,8 esse candidato é seleccionado. Se houver mais do que um candidato o algoritmo filtra apenas aqueles com uma similaridade de 1,0 e se houver apenas um esse é o candidato seleccionado. Em qualquer outro caso nenhum candidato é retornado. O Algoritmo~\ref{lst:alg1} descreve este procedimento usando apenas o título da notícia.

\begin{lstlisting}[language=python,columns=fullflexible,frame=single,label={lst:alg1},title={Algoritmo 1. Ligação com a Wikidata usando apenas o título.},captionpos=b]
def title_only(ent, candidates):
    if len(candidates) == 1:
      if jaro(per,candidates[0]) >= 0.8:
        return candidates[0]
    else:
      filtered = exact(ent, candidates):
	if len(filtered) == 1:
	  return candidates[0]
    return None
\end{lstlisting}

Se nenhum candidato for gerado na primeira fase, o algoritmo tenta expandir as entidades mencionadas no título com base no texto da notícia, explorando o padrão em que tipicamente se uma personalidade é mencionada no título por uma versão simples do seu nome é referida no texto da notícia por um nome mais completo.

O algoritmo começa por identificar todas as pessoas mencionadas no texto da notícia, usando a componente descrita na Secção~\ref{subsec:ner} e selecionando apenas as que têm pelo menos um nome em comum com a personalidade a ser associada à Wikidata. 

Se do processo resulta apenas uma entidade expandida e se há uma similaridade de 1.0 com um dos candidatos anteriormente seleccionados da BC, esse candidato é escolhido. Caso contrário a entidade expandida é usadas para recolher uma nova lista de candidatos da BC, se nessa lista apenas há um candidato e a sua similaridade é de pelo menos 0.8 para com a entidade expandida, esse candidato é escolhido. Se há mais do que um candidatos e apenas um tem uma similaridade 1.0 com a entidade expandida esse é escolhido. 

Se do processo de expansão resultam várias entidades expandidas, filtramos candidatos da BC com similaridade 1.0 para com a entidade expandida, se existir apenas um, esse candidato é o escolhido. Em qualquer outro caso não abrangido pelo algoritmo nenhum candidato é retornado. 

O Algoritmo~\ref{lst:alg2} descreve este procedimento usando o texto da notícia.

\begin{lstlisting}[language=python,columns=fullflexible,frame=single,label={lst:alg2},title={Algoritmo 2. Ligação com a Wikidata usando o texto da notícia para expandir as entidades reconhecidas no título.},captionpos=b]]
def article_text(expanded, candidates):
  if len(expanded) == 1:
    filtered = exact(expanded[0], candidates)
	if len(filtered) == 1:
	  return filtered[0]
	  
    new_candidates = get_candidates(expanded)
    if len(new_candidates) == 1:
      if jaro(expanded, new_candidates[0])>=0.8:
        return candidates[0]
 
    filtered = exact(expanded, new_candidates)
    if len(filtered) == 1:
      return matches[0]
  
  if len(expanded) > 1:
    filtered = []
    for e in expanded:
      filtered.extend(exact(e, candidates))
    if len(filtered) == 1:
      return filtered[0]

  return None
\end{lstlisting}


\begin{comment}

\begin{lstlisting}[language=python,columns=fullflexible,label={lst:alg3},caption=News text approach.]]

def entity_linking(per):
    candidates = get_candidates(ent)
    wiki_id = title_only(per, candidates)
    if not wiki_id:
        expanded = expand(per, news_text)
        wiki_id = article_text(candidates, expanded)
    return wiki_id
\end{lstlisting}

\end{comment}


Os resultados desta abordagem sobre o conjunto de dados anotados e descritos na Secção~\ref{sec:rel_data_annot} são descritos na Tabela~\ref{tab:ent_linking_results}. A classificação \textit{incorrecta} corresponde a personalidades que não foram associadas ao identificador correcto na Wikidata, \textit{não desambiguada} para as que o algoritmo não conseguiu chegar a um identificador único ou não encontrou nenhum identificador na BC.

Na Tabela~\ref{tab:ent_linking_results} são também reportadas duas avaliações, a primeira coluna descreve os resultados para o algoritmo, tal como descrito acima. A coluna a priori é o mesmo algoritmo mas considerando as contagens a priori das referências às entidades mencionadas para com a personalidade que representam na Wikidata. As contagens são usadas para desambiguação. 

\begin{table}[!h]
    \begin{center}
    \begin{tabular}{l rr}
        {\bf Classificação} &               & {\bf a priori} \\
        \hline
        correcta            &   5059        &  5136    \\
        incorrecta          &     43        &    43    \\
		não desambiguada    &    246        &   169    \\    
        \hline
		{\bf Exactidão }    &  0.934	    &  0.958   \\
    \end{tabular}
	\caption{Resultados da avaliação do algoritmo de ligação com a Base de Conhecimento.}
	\label{tab:ent_linking_results}
	\end{center}
\end{table}


Por exemplo, nos dados anotados, todas as personalidades referidas pelo nome \textit{Cavaco} correspondem à personalidade \textit{Cavaco Silva}, usando este conhecimento, no processo de desambiguação todas as referências à \textit{Cavaco} são mapeadas para \textit{Cavaco Silva}. Da mesma forma, de todas as menções a \textit{Marques Mendes} correspondem à personalidade \textit{Luís Marques Mendes}. Usando estes mapeamentos, como mostra segunda coluna da Tabela~\ref{tab:ent_linking_results} conseguimos aumentar a exactidão, dado que reduzimos o número de entidades para as quais não conseguimos encontrar um mapeamento.

\subsection{Classificador de Tipo de Relação}
\label{subsec:rel_classifier}

Decidimos decompor a tarefa de classificação do tipo de relação, descritas na Tabela~\ref{tab:rel_dataset}, em dois classificadores diferentes: um classificador para o tipo de relação e outro para a direcção da relação, por oposição a treinar um único classificador que teria que distinguir de entre 5 classes. Esta secção descreve o classificador do tipo de relação presente num título, tendo 3 classes possíveis: \textbf{opõe-se}, \textbf{apoia} e \textbf{outra}. Todas as experiências descritas foram feitas com uma avaliação cruzada de 4 partições, os resultados reportados são dos resultados sobre todos os conjuntos de teste.

Experimentamos e avaliámos diferentes abordagens para classificação supervisionada das relações presentes nos títulos, nomeadamente: um classificador SVM~\citep{cortes1995support} com um \textit{kerne}l linear, uma rede neuronal recorrente do tipo LSTM~\citep{10.1162/neco.1997.9.8.1735}, e uma rede neuronal do tipo \textit{transformer}, o DistilBERT~\citep{9463516}.

Para o classificador SVM utilizámos como \textit{features} uma abordagem baseada em vectores TF-IDF~\citep{DBLP:journals/ipm/SaltonB88}, fazendo um pré-processamento do título, usando uma padrão, de modo a identificar o contexto relevante, i.e.: o contexto no título que contem informação para identificar a relação: \texttt{<Ent\textsubscript{1} X Ent\textsubscript{2} \textbf{contexto}>} onde \texttt{X} = \{\textit{“diz a”, “responde a”, “sugere a”, “diz que, “afirma que”, “espera que”, “defende que”, “considera que”, “sugere que”, “quer saber se”, “considera”, “manda”}\}. Sempre que não conseguimos extrair um contexto relevante usamos todas as palavras do título excepto o nome das personalidades.

A rede neuronal recorrente LSTM foi usada numa arquitectura bidireccional, ou seja duas LSTMs, ambas com uma dimensão de 128, uma lendo o título da primeira para a última palavra e outra da última para a primeira palavra, sendo que os dois estados finais de cada LSTM são depois concatenados e passados para um \textit{layer} linear. Usamos \textit{embeddings} pré-treinados para Português baseados no método FastText (skip-gram) de dimensão 50, disponibilizados por~\cite{hartmann-etal-2017-portuguese}. A rede foi treinada durante 5 \textit{epochs} com um \textit{batch size} de tamanho 8.
%optimizer = optim.Adam(model.parameters())
%criterion = nn.BCELoss()

O modelo DistilBERT foi treinado tendo como base um modelo pré-treinado para português~\citep{abdaoui-etal-2020-load}, sendo que foi depois afinado no conjunto de dados anotado, i.e.: os pesos de todos os \textit{layers} pré-treinados foram actualizados tendo em conta a tarefa de classificação da relação. A rede foi treinada durante 5 \textit{epochs} com um \textit{batch size} de tamanho 8.
%optimizer = optim.Adam(model.parameters())
%tipo de loss function? nn.BCEWithLogitsLoss(pos_weight=self._class_weights)


\begin{table}
    \begin{subtable}[c]{.5\textwidth}
    \centering
    \begin{tabular}{l ccc}
        {\bf Relação} & {\bf P} & {\bf A} & {\bf F\textsubscript{1}} \\
		\hline
        opõe-se          &  0.71  &  0.69  &  0.70   \\
        outra            &  0.69  &  0.69  &  0.69   \\
        apoia            &  0.65  &  0.69  &  0.67   \\
		\hline
		Macro-Média      &	0.69  &  0.69  &  0.69   \\
    \end{tabular}
    \caption{SVM com um kernel linear\label{tbl:svmlinearaccuracy}}
    \vspace{5mm}           
    \end{subtable}
\quad%  
    \begin{subtable}[c]{.5\textwidth}
    \centering
    \begin{tabular}{l ccc}
        {\bf Relação} & {\bf P} & {\bf A} & {\bf F\textsubscript{1}} \\
		\hline
        opõe-se          &  0.75  &  0.64  &  0.69   \\
        outra            &  0.65  &  0.75  &  0.70   \\
        apoia            &  0.65  &  0.62  &  0.63   \\
		\hline
		Macro-Média      &  0.69  &  0.68  &  0.68   \\
    \end{tabular}
    \caption{LSTM bidireccional\label{tbl:bilstm}}
    \vspace{5mm}     
    \end{subtable}
\quad%   
    \begin{subtable}[c]{.5\textwidth}
    \centering
    \begin{tabular}{l ccc}
        {\bf Relação} & {\bf P} & {\bf A} & {\bf F\textsubscript{1}} \\
		\hline
        opõe-se          &  0.74  &  0.76  &  0.75   \\
        outra            &  0.72  &  0.71  &  0.72   \\
        apoia            &  0.72  &  0.71  &  0.71   \\
		\hline
		Macro-Média      &  0.73  &  0.72  &  0.72   \\
    \end{tabular}
    \caption{DistilBERT \label{tbl:distilbert}}
    \end{subtable}
  \caption{(P)recisão, A(brangência) e F\textsubscript{1} para uma avaliação com 4-partições e validação cruzada com diferentes classificadores.}
  \label{tab:results_relacao}
\end{table}

A Tabela~\ref{tab:results_relacao} descreve os resultados para os vários classificadores. Os resultados mostram que não há diferenças muito acentuadas em termos de performance entre os 3 classificadores, embora a abordagem usando o DistilBERT tenha alcançado os melhores resultados. Ao analisar os resultados notamos que um desafio importante é classificar correctamente títulos que contêm expressões idiomáticas, por exemplo:

\begin{itemize}
\item{\textit{José Lello diz que Nogueira Leite quer “abifar uns tachos”}}
\item{\textit{Jerónimo de Sousa: Passos Coelho “não dá a cara com a careta”}}
\item{\textit{Louçã diz que “António Borges é o grilo falante” de Passo Coelho}}
\item{\textit{Louçã acusa Passos de ser o “cangalheiro da melhor maternidade” do país}}
\end{itemize}

Outras relações são difíceis de classificar porque requerem mais contexto do que aquele presente apenas no título. No conjunto de dados que fazemos público, todos os títulos contêm um URL para o texto da notícia.

\begin{table*}
  \centering
  \begin{tabular}{lc}
      {\bf Título} & {\bf Regra Aplicada} \\
      \hline
	  \textbf{Marques Júnior} elogiado por \textbf{Cavaco Silva} pela "integridade de carácter" & VOZ\_PASSIVA \\
	  \textbf{Passos Coelho} é acusado de imaturidade política por \textbf{Santos Silva}  		& VOZ\_PASSIVA \\
	  \textbf{António Costa} vive no "país das maravilhas" acusa \textbf{Assunção Cristas}      & VERBO\_ENT2 \\
	  \textbf{Passos Coelho} "insultou 500 mil portugueses", acusa \textbf{José Sócrates}		& VERBO\_ENT2 \\ 
	  \textbf{Maria Luís Albuquerque} sob críticas de \textbf{Luís Amado}						& NOUN\_ENT2 \\
	  \textbf{André Ventura} diz-se surpreendido com perda de apoio de \textbf{Cristas}			& NOUN\_ENT2 \\

	  \hline
  \end{tabular}
  \caption{Exemplos de títulos e quais as regras de padrões usadas para detectar a direcção da relação.}
  \label{tab:examples_patterns_direction}
\end{table*}

\subsection{Classificador de Direção da Relação}
\label{subsec:rel_direction}

Esta secção descreve o classificador da direcção com 2 classes possíveis, Ent\textsubscript{1} $\rightarrow$ Ent\textsubscript{2} ou Ent\textsubscript{2}$\leftarrow$Ent\textsubscript{1}. 

Como mostra a Tabela~\ref{tab:rel_dataset}, o conjunto de dados tem um viés para com a classe Ent\textsubscript{1} $\rightarrow$ Ent\textsubscript{2} representando 91,5\% dos dados. Assim, optamos por desenvolver uma abordagem baseada em regras para detectar apenas a classe Ent\textsubscript{2}$\leftarrow$Ent\textsubscript{1}, e sempre que nenhuma das regras se verifica o classificador atribui a classe Ent\textsubscript{1} $\rightarrow$ Ent\textsubscript{2}.

Definimos três regras baseadas em padrões construídos com informação morfológica e sintáctica~\citep{nivre-etal-2020-universal} extraída do título com o spaCy e usando o mesmo modelo usado para reconhecimento de nomes de personalidades, ~\texttt{pt\_core\_news\_lg-3.0.0}. Extraímos a informação morfo-sintáctica de todas as palavras, incluindo para os verbos informação sobre a conjugação: a pessoa e o número.

\begin{itemize}

\item \textbf{VOZ\_PASSIVA}: procuramos por padrões \texttt{<VERB><ADP>}, um verbo seguido de uma proposição, identificamos a presença da voz passiva verificando se a informação morfológica associada ao verbo principal indica a presença da voz passiva, e se for o caso verificamos se a voz passiva envolve as personalidades mencionadas no título. Verificamos se a entidade Ent\textsubscript{1} tem uma dependência para com o verbo do tipo \textbf{acl}, se o verbo tem uma dependência para com a Ent\textsubscript{1} do tipo \textbf{nsubj:pass} ou se o verbo tem uma dependência para com a Ent\textsubscript{2} do tipo \textbf{obl:agent}. 

\item \textbf{VERBO\_ENT2}: detecta o padrão morfológico \texttt{<PUNCT><VERB>Ent\textsubscript{2}<EOS>}, um sinal de pontuação seguido de um verbo, e terminando com a Ent\textsubscript{2}, restringido o verbo a ser conjugado na 3ª pessoa do singular do presente do indicativo, e onde \texttt{<EOS>} representa o final do título, significando que Ent\textsubscript{2} é a última palavra no texto do título.

\item \textbf{NOUN\_ENT2}: verifica se o padrão \texttt{<ADJ>?<NOUN><ADJ>?<ADP>Ent\textsubscript{2}<EOS>} está presente no título, i.e.: um substantivo podendo ser precedido ou sucedido de um ou mais adjectivos terminando com a Ent\textsubscript{2}, sendo que o substantivo é restrito a uma lista de substantivos pré-definida.
\end{itemize}

A Tabela~\ref{tab:examples_patterns_direction} mostra alguns exemplos de títulos de notícias e das regras que foram aplicadas para detectar a direcção {Ent\textsubscript{1} $\leftarrow$ Ent\textsubscript{2}. As regras definidas são aplicadas de forma sequencial, pela mesma ordem que são aqui descritas e se nenhum dos padrões definidos é detectado no título, o classificador classifica a direcção da relação no título como {Ent\textsubscript{1} $\rightarrow$ Ent\textsubscript{2}}.

A Tabela~\ref{tab:direction_clf_results} contem os resultados deste classificador baseado em padrões para o conjunto de dados anotados.

\begin{table}[!h]
    \begin{center}
    \begin{tabular}{l cccr}
        {\bf Direction} & {\bf P} & {\bf A} & {\bf F\textsubscript{1}} & {\bf \#Títulos} \\
        \hline
        \small{Ent\textsubscript{1} $\rightarrow$ Ent\textsubscript{2}} & 0.99  &  1.00  &  0.99  & 1488 \\
		\small{Ent\textsubscript{1} $\leftarrow$ Ent\textsubscript{2}}  & 0.95  &  0.84  &  0.89  & 129  \\
		\hline
	    weighted avg.     &      0.98       & 0.98       & 0.98		&   1517 \\
    \end{tabular}
	\caption{(P)recisão, A(brangência) e F\textsubscript{1} usando 3 regras baseadas em padrões.}
	\label{tab:direction_clf_results}
	\end{center}
\end{table}

Os resultados mostram que o método proposto classifica correctamente grande parte da direcção das relações {Ent\textsubscript{1} $\leftarrow$ Ent\textsubscript{2}, a única classe para as quais forem desenvolvidas regras.

\section{Grafo Semântico}
\label{sec:pipeline}

Os componentes descritos na secção anterior formam o processo de extracção de triplos RDF a partir dos títulos de notícias recolhidos. Os triplos gerados são depois indexados numa base de dados de formando um grafo semântico que pode ser interrogado recorrendo à linguagem SPARQL.

O processo de extracção começa por fazer o reconhecimento de personalidades no título na notícia e a sua ligação com o identificador de cada personalidade na Wikidata. O processo de extracção apenas continua se ambas as personalidades reconhecidas foram ligadas com um identificador na Wikidata, caso contrário o título é descartado.  Após ambas as personalidades estarem ligadas com a Wikidata o processo de extracção detecta o tipo de relação presente no título, se a relação entre as personalidades no título da notícia não for classificada como \textbf{outra} o classificador da direcção da relação é também aplicado ao título. 

Para todos os títulos não descartados em nenhuma etapa do processo, o resultado final é um triplo RDF, ligando personalidades representadas na Wikidata através de uma relação de oposição ou apoio suportada por uma notícia. Os triplos RDF gerados são indexados num motor SPARQL~\citep{jena2015free} juntamente com um sub-grafo da Wikidata descrito na Secção~\ref{sec_kb}.

O grafo tem um total de 680 personalidades políticas, 107 partidos políticos 10.361 notícias. Está disponível online no formato \textit{Terse RDF Triple Language}~\footnote{\url{https://github.com/politiquices/data-releases}} e poder ser também explorado através de um interface web~\footnote{\url{https://www.politiquices.pt}}.

\section{Trabalho Futuro}
\label{sec:future_work}

{\bf TODO: rever}

O grafo semântico gerado por este trabalho dá a oportunidade de realizar diversos estudos, por exemplo: encontrar comunidades~\cite{} de apoio e oposição em função do tempo e verificar quais mudanças entre dentro dessas comunidades ou por exemplo estudar os triângulos políticos: se personalidades políticas X e Y sempre acusam ou defendem uma terceira personalidade Z, qual será a relação típica entre X e Y?

% Texto
% Fazer uso da notícia para ajudar a detectar a relação, normalmente o primeiro parágrafo da notícia tem já informação suficiente.
% A grande maioria das notícias tem como origem o arquivo da web portuguesa, através da sua \textit{API} que retorna o título e o HTML original da página. Limpar os dados, de forma a descartar todo o HTML e ter o corpo da notícia não é uma tarefa simples, especialmente considerando o variedade de domínios e o período temporal. Por esta razão optamos por focar a extracção de relações no título das notícias.
% As relações extraídas podem ser enriquecidas, categorizando-as num ou mais tópicos com base numa análise detalhada do texto da notícia.

% Relações
Alguns títulos contêm uma relação mutua entra as duas personalidades, por exemplo os seguintes títulos: \textit{"Sócrates e Alegre trocam acusações sobre co-incineração"}} ou \textit{"Pinto da Costa rebate críticas de Pacheco Pereira"}}, poderiam ser ambos classificados com a relação Ent\textsubscript{2}$\leftrightarrow$Ent\textsubscript{1}, indicando que ambas as personalidades se acusação. 
% analisar tb títulos com mais do que 2 entidades

% Usar aprendizagem supervisionado para detectar a direcção.
% limitações das datas, são as datas de crawl e não de publicação da notícia, como combater isto?

\section*{Agradecimentos}

Gostaríamos de agradecer ao Nuno Feliciano por todos os comentários dados na construção e elaboração deste trabalho. % Sempre que o autor assim o entender, deverá agradecer aos revisores.

\bibliography{references.bib}


\end{document}
